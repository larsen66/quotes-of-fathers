# ФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ

## Админ-панель «Цитаты Отцов»

## 1. Общие положения

### FR-A0-1. Назначение

Админ-панель предназначена для управления контентом мобильного приложения:

* сущности **Отцы (Father)**
* сущности **Цитаты (Quote)**
* счётчик подписчиков (для экрана «О нас»)
* обработка сообщений обратной связи (Feedback)

### FR-A0-2. Технологический стек

* **FR-A0-2.1:** Frontend: **React** с **TypeScript**
* **FR-A0-2.2:** Backend: **Supabase JS Client** для CRUD операций
* **FR-A0-2.3:** Хостинг: **Vercel** или **Netlify** (бесплатный план)
* **FR-A0-2.4:** Аутентификация: **Supabase Auth**
* **FR-A0-2.5:** База данных: **Supabase (PostgreSQL)**
* **FR-A0-2.6:** Хранилище файлов: **Supabase Storage**

### FR-A0-3. Роли и доступ

* **FR-A0-3.1:** Система должна поддерживать роль **Администратор** (полный доступ).
* **FR-A0-3.2 (опц.):** Роль **Редактор** (создание/редактирование контента без удаления и без управления пользователями).

### FR-A0-4. Аутентификация

* **FR-A0-4.1:** Вход в админ-панель должен требовать авторизацию через Firebase Auth (email/пароль).
* **FR-A0-4.2:** После входа админ видит главную страницу/дашборд.
* **FR-A0-4.3:** Неаутентифицированные пользователи перенаправляются на страницу входа.

---

## 2. Структура админ-панели (разделы)

### FR-A1-1. Разделы меню

Админ-панель должна содержать пункты:

1. Дашборд
2. Отцы
3. Цитаты
4. Подписчики (счётчик)
5. Обратная связь
6. Настройки (опционально: общие параметры проекта)

### FR-A1-2. Навигация

* **FR-A1-2.1:** Использовать React Router для маршрутизации между разделами.
* **FR-A1-2.2:** Боковое меню должно быть всегда видимым (или скрываемым на мобильных).
* **FR-A1-2.3:** Активный раздел должен визуально выделяться в меню.

---

## 3. Дашборд

### FR-A2-1. Сводные показатели

Дашборд должен отображать:

* количество отцов (Father count)
* количество опубликованных цитат (Quote where isPublished=true)
* количество черновиков/неопубликованных цитат
* количество новых сообщений обратной связи (непрочитанных)

### FR-A2-2. Быстрые действия

На дашборде должны быть кнопки:

* “Добавить отца”
* “Добавить цитату”

---

## 4. Раздел «Отцы» (Father Management)

### FR-A3-1. Список отцов

* **FR-A3-1.1:** Админ-панель должна отображать список отцов таблицей.
* **FR-A3-1.2:** Колонки списка: Фото (avatar), Имя, Кол-во цитат, Статус (опц.), Дата создания, Дата изменения.
* **FR-A3-1.3:** Должны быть доступны поиск по имени и сортировка.

### FR-A3-2. Создание отца

* **FR-A3-2.1:** Должна быть форма создания отца со следующими полями:

  * `name_ka` (обязательное) — имя на грузинском
  * `name_ru` (опционально) — имя на русском
  * `avatarUrl` (обязательное) — загрузка изображения или указание URL
  * `profileImageUrl` (опционально) — загрузка изображения или URL
  * `bio_ka` (опционально) — биография на грузинском
  * `bio_ru` (опционально) — биография на русском
  * `order` (опционально)
* **FR-A3-2.2:** При сохранении создаются `createdAt` и `updatedAt`.

### FR-A3-3. Редактирование отца

* **FR-A3-3.1:** Админ должен иметь возможность редактировать все поля отца.
* **FR-A3-3.2:** При сохранении обновляется `updatedAt`.

### FR-A3-4. Удаление отца

* **FR-A3-4.1:** Админ должен иметь возможность удалить отца.
* **FR-A3-4.2:** При удалении система должна обработать связанные цитаты одним из правил (зафиксировать в настройках проекта):

  * Вариант A: запретить удаление, если есть цитаты
  * Вариант B: каскадное удаление цитат
  * Вариант C: перевод цитат в “без автора” (не рекомендуется)
* **FR-A3-4.3:** Удаление должно требовать подтверждения.

---

## 5. Раздел «Цитаты» (Quote Management)

### FR-A4-1. Список цитат

* **FR-A4-1.1:** Админ-панель должна отображать список цитат таблицей.
* **FR-A4-1.2:** Колонки: Отец, Превью текста (первые N символов), Дата добавления (`createdAt`), Статус публикации (`isPublished`), Дата изменения (`updatedAt`).
* **FR-A4-1.3:** Должны быть фильтры:

  * по отцу
  * по статусу (опубликовано/черновик)
  * поиск по тексту (минимум подстрока)
* **FR-A4-1.4:** Сортировки:

  * по `createdAt` (по умолчанию DESC)
  * по `updatedAt`

### FR-A4-2. Создание цитаты

* **FR-A4-2.1:** Должна быть форма создания цитаты со следующими полями:

  * `fatherId` (обязательное) — выбор из списка отцов
  * `text_ka` (обязательное) — полный текст на грузинском
  * `text_ru` (опционально) — полный текст на русском
  * `quoteDate` (опционально)
  * `source_ka` (опционально) — источник на грузинском
  * `source_ru` (опционально) — источник на русском
  * `tags` (опционально)
  * `isPublished` (обязательное, по умолчанию true или false — фиксируется в настройках)
* **FR-A4-2.2:** `createdAt` должен выставляться автоматически как дата/время добавления в админ-панели.
* **FR-A4-2.3:** При сохранении устанавливается `updatedAt`.

### FR-A4-3. Редактирование цитаты

* **FR-A4-3.1:** Админ должен иметь возможность редактировать поля цитаты.
* **FR-A4-3.2:** При редактировании обновляется `updatedAt`.
* **FR-A4-3.3:** Должна быть возможность переключать `isPublished`.

### FR-A4-4. Удаление цитаты

* **FR-A4-4.1:** Админ должен иметь возможность удалить цитату.
* **FR-A4-4.2:** Удаление должно требовать подтверждения.

### FR-A4-5. Массовые операции (опционально, но полезно)

* **FR-A4-5.1:** Массовая смена статуса публикации (publish/unpublish).
* **FR-A4-5.2:** Массовое удаление.
* **FR-A4-5.3:** Импорт цитат из CSV (с маппингом полей отец/текст/дата).

---

## 6. Раздел «Подписчики» (Subscribers Count)

### FR-A5-1. Просмотр счётчика

* **FR-A5-1.1:** Админ-панель должна показывать текущее значение `subscribersCount`.

### FR-A5-2. Редактирование счётчика

* **FR-A5-2.1:** Админ должен иметь возможность вручную изменить значение счётчика.
* **FR-A5-2.2:** При изменении обновляется `updatedAt`.

*(Если счётчик будет считаться автоматически на сервере — этот раздел превращается в “только просмотр”.)*

---

## 7. Раздел «Обратная связь» (Feedback)

### FR-A6-1. Список сообщений

* **FR-A6-1.1:** Админ-панель должна отображать список входящих сообщений.
* **FR-A6-1.2:** Поля: дата, контакт, превью сообщения, статус (прочитано/не прочитано).

### FR-A6-2. Просмотр сообщения

* **FR-A6-2.1:** Админ может открыть сообщение и увидеть полный текст.
* **FR-A6-2.2:** При открытии сообщение помечается как “прочитано” (или кнопкой).

### FR-A6-3. Экспорт (опционально)

* **FR-A6-3.1:** Возможность выгрузить сообщения в CSV.

---

## 8. Управление медиа (изображения)

### FR-A7-1. Загрузка изображений

* **FR-A7-1.1:** Админ-панель должна позволять загружать изображения для `avatar_url` и `profile_image_url`.
* **FR-A7-1.2:** Загрузка изображений реализуется через Supabase Storage.
* **FR-A7-1.3:** После загрузки система возвращает публичный URL.
* **FR-A7-1.4:** Должен отображаться прогресс загрузки (progress bar).

### FR-A7-2. Валидация медиа

* **FR-A7-2.1:** Допустимые форматы: JPG/PNG/WebP.
* **FR-A7-2.2:** Ограничение размера файла (задаётся параметром, например до 5–10 МБ).
* **FR-A7-2.3:** Валидация должна выполняться на frontend до начала загрузки.
* **FR-A7-2.4:** Система должна отклонять неподдерживаемые форматы с понятным сообщением об ошибке.

### FR-A7-3. Предпросмотр изображений

* **FR-A7-3.1:** После выбора файла должен отображаться предпросмотр перед загрузкой.
* **FR-A7-3.2:** В формах редактирования должны отображаться текущие загруженные изображения.

---

## 9. Синхронизация с мобильным приложением (контентные правила)

### FR-A8-1. Источник истины

* **FR-A8-1.1:** Серверные данные админ-панели являются источником истины для Fathers/Quotes.

### FR-A8-2. “Последние цитаты”

* **FR-A8-2.1:** Мобильное приложение должно получать “последние” по полю `createdAt` (дата добавления в админ-панели).
* **FR-A8-2.2:** Админ-панель должна гарантировать наличие `createdAt` у каждой цитаты.

### FR-A8-3. Публикация

* **FR-A8-3.1:** Цитаты с `isPublished=false` не должны попадать в мобильное приложение.

---

## 10. Валидация и ошибки

### FR-A9-1. Валидация

* **FR-A9-1.1:** Поля `Father.name_ka`, `Father.avatarUrl`, `Quote.fatherId`, `Quote.text_ka` обязательны.
* **FR-A9-1.2:** При ошибке валидации должна отображаться подсказка, сохранение блокируется.

### FR-A9-2. Аудит изменений (опционально)

* **FR-A9-2.1:** Система может хранить кто и когда изменил запись (createdBy/updatedBy).

---

## 11. Технические требования к реализации

### FR-A10A-1. Архитектура приложения

* **FR-A10A-1.1:** Использовать функциональные компоненты React с Hooks.
* **FR-A10A-1.2:** Использовать TypeScript для типобезопасности.
* **FR-A10A-1.3:** Организовать код по модульному принципу (компоненты, хуки, сервисы, типы).

### FR-A10A-2. State Management

* **FR-A10A-2.1:** Использовать React Context API для глобального состояния (аутентификация, язык интерфейса).
* **FR-A10A-2.2:** Локальное состояние компонентов управляется через useState/useReducer.
* **FR-A10A-2.3 (опц.):** При необходимости можно использовать Zustand или другую легковесную библиотеку.

### FR-A10A-3. Supabase Integration

* **FR-A10A-3.1:** Операции с базой данных реализуются через Supabase JS Client.
* **FR-A10A-3.2:** Использовать realtime subscriptions для real-time обновлений списков (опционально).
* **FR-A10A-3.3:** Все операции с базой данных должны иметь обработку ошибок.
* **FR-A10A-3.4:** Использовать Supabase Auth для управления сессией пользователя.

### FR-A10A-4. UI Framework

* **FR-A10A-4.1:** Использовать готовую UI-библиотеку для ускорения разработки:
  * Рекомендуется: Material-UI (MUI), Ant Design, или Chakra UI
* **FR-A10A-4.2:** Обеспечить адаптивный дизайн (десктоп + планшет минимум).
* **FR-A10A-4.3:** Формы должны иметь валидацию с понятными сообщениями об ошибках.

### FR-A10A-5. Деплой на Vercel/Netlify

* **FR-A10A-5.1:** Build процесс должен создавать оптимизированную production сборку.
* **FR-A10A-5.2:** Настроить правильную маршрутизацию SPA (rewrites для SPA).
* **FR-A10A-5.3:** Использовать переменные окружения для конфигурации Supabase.

### FR-A10A-6. Производительность

* **FR-A10A-6.1:** Использовать pagination для списков с большим количеством элементов.
* **FR-A10A-6.2:** Реализовать debounce для поисковых полей.
* **FR-A10A-6.3:** Оптимизировать загрузку изображений (компрессия, lazy loading).

### FR-A10A-7. Безопасность

* **FR-A10A-7.1:** Supabase Row Level Security (RLS) должен проверять аутентификацию для операций записи.
* **FR-A10A-7.2:** Supabase Storage Policies должны разрешать загрузку только аутентифицированным пользователям.
* **FR-A10A-7.3:** Использовать только anon key в клиентском коде (не service_role key).

---

## 12. Мультиязычность

### FR-A11-1. Поддерживаемые языки

* **FR-A11-1.1:** Админ-панель должна поддерживать два языка интерфейса:
  * **Грузинский (ka)** — основной язык
  * **Русский (ru)** — дополнительный язык
* **FR-A11-1.2:** Язык интерфейса выбирается в настройках пользователя или в шапке приложения.
* **FR-A11-1.3:** Использовать react-i18next или аналогичную библиотеку для локализации интерфейса.

### FR-A11-2. Язык интерфейса админ-панели

* **FR-A11-2.1:** Все элементы интерфейса (меню, кнопки, заголовки, сообщения) должны отображаться на выбранном языке.
* **FR-A11-2.2:** Переключение языка должно быть доступно в настройках профиля или в шапке админ-панели.
* **FR-A11-2.3:** Выбранный язык сохраняется в localStorage браузера.

### FR-A11-3. Мультиязычный контент — Отцы

* **FR-A11-3.1:** При создании/редактировании отца должны быть доступны поля для обоих языков:
  * `name.ka` (обязательное) — имя на грузинском
  * `name.ru` (опционально) — имя на русском
  * `bio.ka` (опционально) — биография на грузинском
  * `bio.ru` (опционально) — биография на русском
* **FR-A11-3.2:** В списке отцов отображается имя на текущем языке интерфейса (при отсутствии — на грузинском).
* **FR-A11-3.3:** При отсутствии перевода на выбранный язык система должна использовать грузинский как fallback.
* **FR-A11-3.4:** Форма должна визуально разделять поля разных языков (например, табами или группами).

### FR-A11-4. Мультиязычный контент — Цитаты

* **FR-A11-4.1:** При создании/редактировании цитаты должны быть доступны поля для обоих языков:
  * `text.ka` (обязательное) — текст цитаты на грузинском
  * `text.ru` (опционально) — текст цитаты на русском
  * `source.ka` (опционально) — источник на грузинском
  * `source.ru` (опционально) — источник на русском
* **FR-A11-4.2:** В списке цитат отображается текст на текущем языке интерфейса (при отсутствии — на грузинском).
* **FR-A11-4.3:** При отсутствии перевода на выбранный язык система должна использовать грузинский как fallback.
* **FR-A11-4.4:** Форма должна визуально разделять поля разных языков (например, табами или группами).

### FR-A11-5. Синхронизация с мобильным приложением

* **FR-A11-5.1:** Supabase хранит языковые версии в отдельных колонках (name_ka, name_ru, text_ka, text_ru).
* **FR-A11-5.2:** Мобильное приложение получает все колонки с обеими языковыми версиями.
* **FR-A11-5.3:** Мобильное приложение само выбирает нужный язык на основе настроек пользователя.

---

## 13. Руководство по разработке админ-панели

### FR-A12-1. Структура проекта

Рекомендуемая структура React-приложения:

```
admin/
├── public/
│   └── index.html
├── src/
│   ├── components/
│   │   ├── common/           # Общие компоненты (кнопки, модалы и т.д.)
│   │   ├── layout/           # Layout компоненты (меню, header)
│   │   ├── fathers/          # Компоненты управления отцами
│   │   └── quotes/           # Компоненты управления цитатами
│   ├── contexts/             # React contexts (auth, locale)
│   ├── hooks/                # Пользовательские хуки
│   ├── pages/                # Страницы приложения
│   │   ├── Dashboard.tsx
│   │   ├── FathersPage.tsx
│   │   ├── QuotesPage.tsx
│   │   ├── SettingsPage.tsx
│   │   └── LoginPage.tsx
│   ├── services/
│   │   ├── supabase.ts       # Конфигурация Supabase
│   │   ├── auth.ts           # Аутентификация
│   │   ├── fathers.ts        # CRUD операции для отцов
│   │   ├── quotes.ts         # CRUD операции для цитат
│   │   ├── feedback.ts       # Операции с обратной связью
│   │   ├── settings.ts       # Глобальные настройки
│   │   └── storage.ts        # Операции с Supabase Storage
│   ├── types/
│   │   ├── database.ts       # Типы из Supabase schema
│   │   └── index.ts
│   ├── utils/
│   │   ├── localization.ts   # Функции локализации
│   │   └── validation.ts     # Валидация форм
│   ├── locales/              # Переводы интерфейса
│   │   ├── ka.json
│   │   └── ru.json
│   ├── App.tsx
│   └── main.tsx
├── .env.example              # Пример конфигурации Supabase
├── package.json
├── tsconfig.json
└── vite.config.ts
```

### FR-A12-2. Основные зависимости

Минимальный набор зависимостей для проекта:

```json
{
  "dependencies": {
    "react": "^19.x",
    "react-dom": "^19.x",
    "react-router-dom": "^7.x",
    "@supabase/supabase-js": "^2.x",
    "@mui/material": "^7.x",
    "@mui/icons-material": "^7.x",
    "react-i18next": "^16.x",
    "i18next": "^25.x"
  },
  "devDependencies": {
    "@types/react": "^19.x",
    "@types/react-dom": "^19.x",
    "typescript": "^5.x",
    "vite": "^7.x"
  }
}
```

### FR-A12-3. Конфигурация Supabase

Пример файла `src/services/supabase.ts`:

```typescript
import { createClient } from '@supabase/supabase-js';
import { Database } from '../types/database';

const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL;
const SUPABASE_ANON_KEY = import.meta.env.VITE_SUPABASE_ANON_KEY;

export const supabase = createClient<Database>(SUPABASE_URL, SUPABASE_ANON_KEY);
```

### FR-A12-4. Пример CRUD операций

Пример файла `src/services/fathers.ts`:

```typescript
import { supabase } from './supabase';
import { Father, FatherInsert, FatherUpdate } from '../types/database';

export async function getFathers(): Promise<Father[]> {
  const { data, error } = await supabase
    .from('fathers')
    .select('*')
    .eq('deleted', false)
    .order('order', { ascending: true, nullsFirst: false });

  if (error) throw error;
  return data ?? [];
}

export async function getFather(id: string): Promise<Father | null> {
  const { data, error } = await supabase
    .from('fathers')
    .select('*')
    .eq('id', id)
    .single();

  if (error) {
    if (error.code === 'PGRST116') return null;
    throw error;
  }
  return data;
}

export async function createFather(father: Omit<FatherInsert, 'id' | 'created_at' | 'updated_at'>): Promise<Father> {
  const { data, error } = await supabase
    .from('fathers')
    .insert(father)
    .select()
    .single();

  if (error) throw error;
  return data;
}

export async function updateFather(id: string, father: FatherUpdate): Promise<Father> {
  const { data, error } = await supabase
    .from('fathers')
    .update(father)
    .eq('id', id)
    .select()
    .single();

  if (error) throw error;
  return data;
}

export async function deleteFather(id: string): Promise<void> {
  // Soft delete
  const { error } = await supabase
    .from('fathers')
    .update({ deleted: true })
    .eq('id', id);

  if (error) throw error;
}
```

### FR-A12-5. Деплой на Vercel

**Шаг 1: Установка Vercel CLI**

```bash
npm install -g vercel
vercel login
```

**Шаг 2: Build и Deploy**

```bash
cd admin
npm run build
vercel deploy --prod
```

**Шаг 3: Настройка переменных окружения в Vercel Dashboard**

В Settings → Environment Variables добавьте:
- `VITE_SUPABASE_URL`
- `VITE_SUPABASE_ANON_KEY`

**Альтернатива: Netlify**

```bash
npm install -g netlify-cli
netlify login
npm run build
netlify deploy --prod --dir=dist
```

### FR-A12-6. Настройка безопасности

**Supabase Row Level Security (выполнить в SQL Editor):**

```sql
-- Enable RLS on tables
ALTER TABLE fathers ENABLE ROW LEVEL SECURITY;
ALTER TABLE quotes ENABLE ROW LEVEL SECURITY;
ALTER TABLE feedback ENABLE ROW LEVEL SECURITY;

-- Public read access (для мобильного приложения)
CREATE POLICY "Public read for fathers"
  ON fathers FOR SELECT TO anon, authenticated
  USING (true);

CREATE POLICY "Public read for quotes"
  ON quotes FOR SELECT TO anon, authenticated
  USING (true);

-- Authenticated write access (для админ-панели)
CREATE POLICY "Admin write for fathers"
  ON fathers FOR ALL TO authenticated
  USING (true) WITH CHECK (true);

CREATE POLICY "Admin write for quotes"
  ON quotes FOR ALL TO authenticated
  USING (true) WITH CHECK (true);

-- Anyone can submit feedback
CREATE POLICY "Public insert for feedback"
  ON feedback FOR INSERT TO anon, authenticated
  WITH CHECK (true);

-- Only authenticated users can read/manage feedback
CREATE POLICY "Admin read for feedback"
  ON feedback FOR SELECT TO authenticated
  USING (true);
```

**Supabase Storage Policies:**

```sql
-- Public read access for images
CREATE POLICY "Public read for storage"
  ON storage.objects FOR SELECT TO anon, authenticated
  USING (bucket_id = 'fathers');

-- Authenticated write access for images
CREATE POLICY "Auth upload for storage"
  ON storage.objects FOR INSERT TO authenticated
  WITH CHECK (bucket_id = 'fathers');
```

### FR-A12-7. Оценка времени разработки

* **Настройка проекта и конфигурация Firebase:** 30-45 минут
* **Аутентификация (Login/Logout):** 30 минут
* **Dashboard:** 20-30 минут
* **CRUD для Отцов:** 45-60 минут
* **CRUD для Цитат:** 45-60 минут
* **Загрузка изображений:** 30-45 минут
* **Мультиязычность интерфейса:** 30 минут
* **Настройка подписчиков и обратной связи:** 30 минут
* **Тестирование и deploy:** 30 минут

**Общее время:** 5-7 часов для базовой версии (включая изучение документации)

**Минимальная версия (2-3 часа):**
* Аутентификация
* CRUD для Отцов
* CRUD для Цитат
* Базовая загрузка изображений
* Deploy на Firebase Hosting

---

## 14. Преимущества выбранного подхода

### FR-A13-1. Бесплатность

* ✅ Vercel/Netlify: бесплатный хостинг для статических сайтов
* ✅ Supabase: бесплатный план (500 MB базы данных, 1 GB Storage)
* ✅ Supabase Auth: бесплатен для email/пароль (до 50K MAU)
* ✅ PostgreSQL: полноценная реляционная база данных
* ✅ Достаточно для малого и среднего проекта

### FR-A13-2. Полный контроль

* ✅ Исходный код полностью принадлежит разработчику
* ✅ Можно кастомизировать любые аспекты UI/UX
* ✅ Легко добавлять новые функции
* ✅ Нет привязки к платформам (Retool, Airtable и т.д.)
* ✅ Полный SQL доступ к базе данных

### FR-A13-3. Простота разработки

* ✅ React - популярный и понятный фреймворк
* ✅ Supabase JS Client - простое и типизированное API
* ✅ Готовые UI-библиотеки (MUI, Ant Design)
* ✅ TypeScript для типобезопасности
* ✅ Много документации и примеров
* ✅ SQL для сложных запросов

### FR-A13-4. Масштабируемость

* ✅ Легко расширять функциональность
* ✅ Row Level Security для гибкого управления доступом
* ✅ Realtime subscriptions для live-обновлений
* ✅ Edge Functions для серверной логики
* ✅ При росте проекта легко перейти на платные планы Supabase

---

**Итог:** Админ-панель на React + Supabase - оптимальное решение по соотношению время разработки / функциональность / стоимость.
